config:
  prerequisites:
    - ../minbase/stacker.yaml

stubby-build-env:
  build_only: true
  from:
    type: built
    tag: minbase
  run: |
    pkgtool install binutils gcc gnu-efi libc6-dev make tar

stubby-build:
  build_only: true
  from:
    type: built
    tag: stubby-build-env
  import:
    - "https://github.com/puzzleos/stubby/archive/refs/tags/v1.0.1.tar.gz"
  run: |
    #!/bin/bash -ex
    tar -xvf /stacker/v*.tar.gz
    cd stubby* || {
      echo "stubby tarball did not create a single dir matching stubby*:" stubby*;
      exit 1;
    }
    make
    mkdir /export
    tar -cf /export/stubby.tar stubby.efi stubby-smash.1.sh stubby-smash.2.sh sbat.csv
